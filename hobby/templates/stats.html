{% extends "base.html" %}

{% block title %}–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ - –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∏–¥–µ–π –¥–ª—è —Ö–æ–±–±–∏{% endblock %}

{% block content %}
<div class="stats-page">
    <h1>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∞–π—Ç–∞</h1>
    <p class="page-description">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ —Å–∞–º—ã—Ö –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Ö–æ–±–±–∏ –∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π –Ω–∞ –Ω–∞—à–µ–º —Å–∞–π—Ç–µ</p>

    {% if stats %}
    <!-- –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-lightbulb fa-2x"></i>
            </div>
            <div class="stat-number">{{ stats.total_ideas }}</div>
            <div class="stat-label">–í—Å–µ–≥–æ –∏–¥–µ–π</div>
        </div>

        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-heart fa-2x"></i>
            </div>
            <div class="stat-number">{{ stats.total_votes }}</div>
            <div class="stat-label">–í—Å–µ–≥–æ –≥–æ–ª–æ—Å–æ–≤</div>
        </div>

        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-users fa-2x"></i>
            </div>
            <div class="stat-number">{{ stats.user_submitted }}</div>
            <div class="stat-label">–ò–¥–µ–π –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
        </div>

        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-chart-line fa-2x"></i>
            </div>
            <div class="stat-number">
                {{ "%.1f"|format(stats.total_votes|float / stats.total_ideas) if stats.total_ideas > 0 else 0 }}
            </div>
            <div class="stat-label">–°—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥</div>
        </div>
    </div>

    <!-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –∏–¥–µ–∏ -->
    <div class="chart-container">
        <h2><i class="fas fa-history"></i> –ù–µ–¥–∞–≤–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –∏–¥–µ–∏</h2>
        <div class="recent-ideas-grid">
            {% for idea in stats.recent_ideas %}
            <div class="recent-idea-card">
                <div class="recent-idea-category">{{ idea.category }}</div>
                <h5>{{ idea.title }}</h5>
                <p class="recent-idea-meta">
                    <span><i class="fas fa-heart"></i> {{ idea.votes }}</span>
                    <span><i class="fas fa-calendar"></i> {{ idea.created_at }}</span>
                </p>
            </div>
            {% endfor %}
        </div>
    </div>

    {% else %}
    <div class="no-stats">
        <i class="fas fa-chart-bar fa-3x"></i>
        <h3>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞</h3>
        <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ–∑–∂–µ</p>
        {% if error %}
        <div class="error-message">
            <p><strong>–û—à–∏–±–∫–∞:</strong> {{ error }}</p>
        </div>
        {% endif %}
    </div>
    {% endif %}
</div>
{% endblock %}

{% block scripts %}
<script>
    // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    document.addEventListener('DOMContentLoaded', function() {
        const statNumbers = document.querySelectorAll('.stat-number');
        statNumbers.forEach(stat => {
            const finalValue = parseInt(stat.textContent);
            let currentValue = 0;
            const increment = finalValue / 50;
            const timer = setInterval(() => {
                currentValue += increment;
                if (currentValue >= finalValue) {
                    stat.textContent = finalValue.toLocaleString();
                    clearInterval(timer);
                } else {
                    stat.textContent = Math.floor(currentValue).toLocaleString();
                }
            }, 30);
        });
    });
</script>
{% endblock %}