{% extends "base.html" %}

{% block title %}–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∏–¥–µ–π –¥–ª—è —Ö–æ–±–±–∏ - –ì–ª–∞–≤–Ω–∞—è{% endblock %}

{% block content %}
<div class="hero">
    <h1>–ù–µ –∑–Ω–∞–µ—Ç–µ, —á–µ–º –∑–∞–Ω—è—Ç—å—Å—è?</h1>
    <p class="subtitle">–ù–∞—à –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø–æ–º–æ–∂–µ—Ç –Ω–∞–π—Ç–∏ –∏–¥–µ–∞–ª—å–Ω–æ–µ —Ö–æ–±–±–∏ –¥–ª—è –ª—é–±–æ–≥–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π</p>

    <div class="hero-buttons">
        <a href="{{ url_for('generate_idea') }}" class="btn-primary">
            <i class="fas fa-random"></i> –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–¥–µ—é
        </a>
        <a href="{{ url_for('challenge') }}" class="btn-secondary">
            <i class="fas fa-trophy"></i> –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π —á–µ–ª–ª–µ–Ω–¥–∂
        </a>
    </div>
</div>

<!-- –ß–µ—Ç—ã—Ä–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –≤ –æ–¥–Ω–æ–º —Ä—è–¥—É -->
<div class="features">
    <a href="{{ url_for('filters_page') }}" class="feature-card-link">
        <div class="feature-card">
            <div class="feature-icon">
                <i class="fas fa-filter"></i>
            </div>
            <h3>–§–∏–ª—å—Ç—Ä—ã</h3>
            <p>–ü–æ–¥–±–µ—Ä–∏—Ç–µ —Ö–æ–±–±–∏ –ø–æ –≤—Ä–µ–º–µ–Ω–∏, –±—é–¥–∂–µ—Ç—É –∏ –º–µ—Å—Ç—É</p>
        </div>
    </a>

    <a href="{{ url_for('community') }}" class="feature-card-link">
        <div class="feature-card">
            <div class="feature-icon">
                <i class="fas fa-users"></i>
            </div>
            <h3>–°–æ–æ–±—â–µ—Å—Ç–≤–æ</h3>
            <p>–ö–æ–ª–ª–µ–∫—Ü–∏—è –∏–¥–µ–π –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</p>
        </div>
    </a>

    <a href="{{ url_for('challenge') }}" class="feature-card-link">
        <div class="feature-card">
            <div class="feature-icon">
                <i class="fas fa-calendar-alt"></i>
            </div>
            <h3>–ß–µ–ª–ª–µ–Ω–¥–∂–∏</h3>
            <p>–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è –¥–ª—è –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏—è</p>
        </div>
    </a>

    <a href="{{ url_for('share') }}" class="feature-card-link">
        <div class="feature-card">
            <div class="feature-icon">
                <i class="fas fa-plus-circle"></i>
            </div>
            <h3>–î–æ–±–∞–≤—å—Ç–µ —Å–≤–æ—ë</h3>
            <p>–ü–æ–¥–µ–ª–∏—Ç–µ—Å—å —Å–≤–æ–µ–π —Ç–≤–æ—Ä—á–µ—Å–∫–æ–π –∏–¥–µ–µ–π</p>
        </div>
    </a>
</div>

<!-- –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∏–¥–µ–∏ - –æ—Ç–¥–µ–ª—å–Ω—ã–π –±–ª–æ–∫ -->
<div class="popular-ideas">
    <h2>–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∏–¥–µ–∏</h2>
    <p class="section-description">–°–∞–º—ã–µ –≤–æ—Å—Ç—Ä–µ–±–æ–≤–∞–Ω–Ω—ã–µ —Ö–æ–±–±–∏ –æ—Ç –Ω–∞—à–µ–≥–æ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞</p>

    <div class="ideas-grid">
        {% if popular_ideas %}
            {% for idea in popular_ideas %}
            <div class="idea-card">
                <div class="idea-category">{{ idea.category }}</div>
                <h4>{{ idea.title }}</h4>
                <p class="idea-meta">
                    <span><i class="fas fa-clock"></i>
                        {% if idea.time_required == 'short' %}–î–æ 1 —á–∞—Å–∞
                        {% elif idea.time_required == 'medium' %}1-3 —á–∞—Å–∞
                        {% elif idea.time_required == 'long' %}–ë–æ–ª–µ–µ 3 —á–∞—Å–æ–≤
                        {% else %}{{ idea.time_required }}{% endif %}
                    </span>
                    <span><i class="fas fa-wallet"></i>
                        {% if idea.budget == 'free' %}–ë–µ—Å–ø–ª–∞—Ç–Ω–æ
                        {% elif idea.budget == 'low' %}–ù–∏–∑–∫–∏–π
                        {% elif idea.budget == 'medium' %}–°—Ä–µ–¥–Ω–∏–π
                        {% elif idea.budget == 'high' %}–í—ã—Å–æ–∫–∏–π
                        {% else %}{{ idea.budget }}{% endif %}
                    </span>
                    <span><i class="fas fa-map-marker-alt"></i>
                        {% if idea.location == 'indoor' %}–î–æ–º–∞
                        {% elif idea.location == 'outdoor' %}–ù–∞ —É–ª–∏—Ü–µ
                        {% elif idea.location == 'both' %}–õ—é–±–æ–µ
                        {% else %}{{ idea.location }}{% endif %}
                    </span>
                </p>
                <p class="idea-description">{{ idea.description[:120] }}...</p>
                <div class="idea-actions">
                    <button onclick="voteIdea({{ idea.id }})" class="btn-action small">
                        <i class="fas fa-heart"></i> {{ idea.votes }}
                    </button>
                    <a href="{{ url_for('generate_idea') }}?category={{ idea.category }}" class="btn-action small">
                        <i class="fas fa-random"></i> –ü–æ–¥–æ–±–Ω—ã–µ
                    </a>
                    <button onclick="addToMyIdeas({{ idea.id }})" class="btn-action small">
                        <i class="fas fa-bookmark"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                    </button>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <div class="no-ideas">
                <i class="fas fa-search fa-2x"></i>
                <h3>–ó–∞–≥—Ä—É–∑–∫–∞ –∏–¥–µ–π...</h3>
                <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–µ—Ä–≤—É—é –∏–¥–µ—é</p>
                <a href="{{ url_for('generate_idea') }}" class="btn-primary mt-2">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–¥–µ—é</a>
            </div>
        {% endif %}
    </div>

    <div class="text-center mt-4">
        <a href="{{ url_for('all_ideas') }}" class="btn-link">
            –°–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ –∏–¥–µ–∏ <i class="fas fa-arrow-right"></i>
        </a>
    </div>
</div>

<!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) -->
{% if categories_stats %}
<div class="categories-stats">
    <h3>–ò–¥–µ–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</h3>
    <div class="categories-grid">
        {% for category, count in categories_stats %}
        <div class="category-badge">
            <span class="category-name">{{ category }}</span>
            <span class="category-count">{{ count }}</span>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}
{% endblock %}

{% block scripts %}
<script>
    function voteIdea(ideaId) {
        fetch(`/vote/${ideaId}`, { method: 'POST' })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // –ù–∞—Ö–æ–¥–∏–º –∫–Ω–æ–ø–∫—É —Å –≥–æ–ª–æ—Å–∞–º–∏ –∏ –æ–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫
                    const buttons = document.querySelectorAll(`button[onclick*="voteIdea(${ideaId})"]`);
                    buttons.forEach(btn => {
                        const icon = btn.querySelector('i');
                        const text = btn.textContent.trim();
                        const currentVotes = parseInt(text.replace(/\D/g, ''));
                        if (!isNaN(currentVotes)) {
                            btn.innerHTML = `<i class="fas fa-heart"></i> ${currentVotes + 1}`;
                        }
                    });

                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                    showToast('–°–ø–∞—Å–∏–±–æ –∑–∞ –≤–∞—à –≥–æ–ª–æ—Å! ‚ù§Ô∏è', 'success');
                }
            })
            .catch(error => {
                console.error('–û—à–∏–±–∫–∞:', error);
                showToast('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞', 'error');
            });
    }

    function addToMyIdeas(ideaId) {
        fetch(`/add_to_my_ideas/${ideaId}`, { method: 'POST' })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showToast('–ò–¥–µ—è –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ –≤–∞—à—É –∫–æ–ª–ª–µ–∫—Ü–∏—é! üìö', 'success');
                } else {
                    showToast(data.message, 'info');
                }
            })
            .catch(error => {
                console.error('–û—à–∏–±–∫–∞:', error);
                showToast('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞', 'error');
            });
    }

    function showToast(message, type = 'info') {
        // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        const toast = document.createElement('div');
        toast.className = `toast toast-${type}`;
        toast.innerHTML = `
            <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
            <span>${message}</span>
        `;

        document.body.appendChild(toast);

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º
        setTimeout(() => toast.classList.add('show'), 10);

        // –£–±–∏—Ä–∞–µ–º —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
        setTimeout(() => {
            toast.classList.remove('show');
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.parentNode.removeChild(toast);
                }
            }, 300);
        }, 3000);
    }
</script>
{% endblock %}